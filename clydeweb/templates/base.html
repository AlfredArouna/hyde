<!DOCTYPE HTML>
<html>
  <head>
    <title>Clyde - Hyde on the Cloud</title>
    <link rel="stylesheet" href="{{static_url("clyde.css")}}" 
        type="text/css" media="screen" charset="utf-8">        
        <script type="text/javascript" src="http://www.google.com/jsapi"></script>
        <script type="text/javascript">
            google.load("jquery", "1.3");
        </script>                   
        <script src="{{static_url("jstree/jquery.tree.min.js")}}" type="text/javascript" charset="utf-8"></script> 
        <script src="{{static_url("markitup/jquery.markitup.pack.js")}}" type="text/javascript" charset="utf-8"></script> 
        <script src="{{static_url("markitup/sets/hyde/base.js")}}" type="text/javascript" charset="utf-8"></script> 
        
        <link rel="stylesheet" type="text/css" href="{{static_url("markitup/skins/simple/style.css")}}" />
        <link rel="stylesheet" type="text/css" href="{{static_url("markitup/sets/default/style.css")}}" />           
  </head>
  <body>
      <header>                              
          <hgroup>
              <h1>Clyde</h1>
          </hgroup>
          <nav>
            <ul> 
                <li><a id="sites-button" href="/sites">Sites<span>&darr;</span></a></li>
                <li><a id="signout-button" href="/signout">Sign Out</a></li>
            </ul>    
          </nav> 
      </header>  
      <nav id="sites">
      </nav>
      <aside> 
          <div id="header-bar">
           <hgroup>
              <h2>{{site}}</h2>
           </hgroup>   
            <div class="buttonbar">
               <a id="new-file-button" class="button" href="/site/{{site}}/new-folder"><img title="New File" alt="New File" src="{{static_url("images/document--plus.png")}}"></a>
               <a id="new-folder-button" class="button"  href="/site/{{site}}/new-file"><img title="New Folder" alt="New Folder" src="{{static_url("images/folder--plus.png")}}"></a>               
               <a id="push-button" class="button" href="/site/{{site}}/publish"><img title="Publish" alt="Publish" src="{{static_url("images/network-cloud.png")}}"></a>                
             </div>
           </div>
           <div id="files"></div>
      </aside>                           
      <section> 
          <div id="crumbs">
              <h2>Select a file</h2>             
          </div> 
          <textarea id="editor"></textarea>
           <p>
              Select a file from the file navigator to the left to edit
              or press the add button to create a new file. When done 
              press the publish button if you are ready.
            </p>
      </section>
      <footer>
          <ul>      
            <li><a rel="external" href="http://ringce.com/hyde">
                Hyde</a></li>
            <li><a rel="external" 
            href="http://github.com/lakshmivyas/hyde">
                Source</a></li>
            <li><a rel="external"
            href="http://groups.google.com/group/hyde-dev">
                Discussions</a></li></ul>                                               
                <br/><br/>
           <p><a href="http://www.pinvoke.com">Fugue Icons</a> by Yusuke Kamiyamane.</p>
      </footer>  
      <script type="text/javascript">  
                var current_path = null;
                var sites = null;                 

                var save_draft = function(){
                      if (!current_path) return false;   
                      $.post('/site/{{site}}/content/save', {
                          path: current_path,
                          content: $("#editor").val()
                      });
                      return false;
                   }

                $(function(){  
                    
                   $("#editor").markItUp(getHydeSet(save_draft));
                   $("#sites-button").unbind('click').bind('click', function(){
                       if (!sites){ 
                          $.getJSON('/sites', function(data){
                              sites = data;
                              var site_list = "<ol style=\"display:none\">";
                              $(sites).each(function(i, site){    
                                 site_list += "<li><a href=\"/site/";
                                 site_list += site;
                                 site_list += "\">"; 
                                 site_list += site; 
                                 site_list += "</a></li>";                                  
                              });                                                         
                              site_list += "</ol>";
                              $("#sites").html(site_list);
                              $("#sites ol").slideDown("slow");       
                              $("#sites-button span").html("&uarr;"); 
                          }); 
                       }  else{
                           $("#sites ol").slideToggle("slow", function(){
                               if($(this).is(":hidden")){
                                   $("#sites-button span").html("&darr;");
                               } else {
                                   $("#sites-button span").html("&uarr;");
                               }
                           });
                       }  
                       return false;
                   });
                   
                   $("#push-button").unbind('click').bind('click', function(){
                         $.post('/site/{{site}}/publish');
                         return false;
                      });
                   $("#files").tree({ 
                       ui : { 
                           dots: false,
                           theme_name: "apple",
                           theme_path: "{{static_url("jstree/themes/apple/style.css")}}"
                       }, 
                       types : {
                           "file" : {
                                      max_children : 0,
                                      icon : { 
                                          image : "{{static_url("jstree/themes/apple/file.png")}}"
                                      }        
                           }
                       },
                      data : {
                          type: 'json',
                          opts : {
                                  url: '/site/{{site}}/files'
                          }
                      },
                      callback : {
                          onchange: function(node, tree){
                              current_path = node.attributes.tooltip.value;  
                              $("#crumbs h2").text("/" + current_path);                              
                              $("#editor").load(
                                  '/site/{{site}}/content?path=' + encodeURIComponent(current_path));                            
                          }
                      }

                   }); 
                });
            </script>
  </body>
</html>