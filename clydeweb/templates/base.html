<!DOCTYPE HTML>
<html>
  <head>
    <title>Clyde - Hyde on the Cloud</title>
    <link rel="stylesheet" href="{{static_url("clyde.css")}}" 
        type="text/css" media="screen" charset="utf-8">        
        <script type="text/javascript" src="http://www.google.com/jsapi"></script>
        <script type="text/javascript">
            google.load("jquery", "1.3");
        </script>                   
        <script src="{{static_url("jstree/jquery.tree.min.js")}}" type="text/javascript" charset="utf-8"></script> 
        <script src="{{static_url("markitup/jquery.markitup.pack.js")}}" type="text/javascript" charset="utf-8"></script> 
        <script src="{{static_url("markitup/sets/default/set.js")}}" type="text/javascript" charset="utf-8"></script>
        <link rel="stylesheet" type="text/css" href="{{static_url("markitup/skins/simple/style.css")}}" />
        <link rel="stylesheet" type="text/css" href="{{static_url("markitup/sets/default/style.css")}}" />           
  </head>
  <body>
      <header>                              
          <hgroup>
              <h1>Clyde</h1>
          </hgroup>
          <nav>
            <ul> 
                <li>Sites</li>
                <li>Sign Out</li>
            </ul>    
          </nav>
      </header>
      <aside> 
          <hgroup>
              <h2>{{site}}</h2>
           </hgroup>   
           <div id="files"></div>
      </aside>                           
      <section> 
          <div id="crumbs">
              <h2>Select a file</h2>
              <div class="buttonbar">
                <a id="new-button" class="button" href="/site/mysite/new">New</a>
                <a id="save-button" class="button" href="/site/mysite/content/save">Save</a>
                <a id="push-button" class="button" href="/site/mysite/push">Publish</a>                
              </div>
          </div> 
          <textarea id="editor"></textarea>
           <p>
              Select a file from the file navigator to the left to edit
              or press the add button to create a new file. When done 
              press the publish button if you are ready.
            </p>
      </section>
      <footer>
          <ul>      
            <li><a rel="external" href="http://ringce.com/hyde">
                Hyde</a></li>
            <li><a rel="external" 
            href="http://github.com/lakshmivyas/hyde">
                Source</a></li>
            <li><a rel="external"
            href="http://groups.google.com/group/hyde-dev">
                Discussions</a></li>
      </footer>  
      <script type="text/javascript">  
                var current_path = null;
                $(function(){  
                   $("#editor").markItUp();
                   $("#save-button").unbind('click').bind('click', function(){
                      if (!current_path) return false;   
                      $.post('/site/mysite/content/save', {
                          path: current_path,
                          content: $("#editor").val()
                      });
                      return false;
                   });
                   $("#files").tree({ 
                       ui : { 
                           dots: false,
                           theme_name: "apple",
                           theme_path: "{{static_url("jstree/themes/apple/style.css")}}"
                       }, 
                       types : {
                           "file" : {
                                      max_children : 0,
                                      icon : { 
                                          image : "{{static_url("jstree/themes/apple/file.png")}}"
                                      }        
                           }
                       },
                      data : {
                          type: 'json',
                          opts : {
                                  url: '/site/mysite/files'
                          }
                      },
                      callback : {
                          onchange: function(node, tree){
                              current_path = node.attributes.tooltip.value;  
                              $("#crumbs h2").text(current_path);                              
                              $("#editor").load(
                                  '/site/mysite/content?path=' + encodeURIComponent(current_path));                            
                          }
                      }

                   }); 
                });
            </script>
  </body>
</html>